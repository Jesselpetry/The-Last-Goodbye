-- Migration V3: Add is_private column to replies, ensure all friend columns exist, and insert default home page content

-- 1. Add is_private column to replies table
ALTER TABLE replies ADD COLUMN IF NOT EXISTS is_private BOOLEAN DEFAULT FALSE;

-- 2. Ensure all friend columns exist (idempotent checks)
ALTER TABLE friends ADD COLUMN IF NOT EXISTS image_urls text[] DEFAULT '{}';
ALTER TABLE friends ADD COLUMN IF NOT EXISTS spotify_url text;
ALTER TABLE friends ADD COLUMN IF NOT EXISTS bgm_url text;
ALTER TABLE friends ADD COLUMN IF NOT EXISTS unlock_date timestamp with time zone;

-- 3. Insert default home page content if not exists
INSERT INTO friends (slug, name, passcode, content, image_urls, is_viewed, unlock_date)
SELECT 'home', 'Everyone', '0000', '1,095 ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏ó‡∏∏‡∏°‡πÄ‡∏ó‡∏û‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏Ñ‡∏≤‡∏£... ‡πÄ‡∏ß‡∏•‡∏≤‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ‡πÑ‡∏ß‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÇ‡∏Å‡∏´‡∏Å‡πÄ‡∏•‡∏¢‡πÄ‡∏ô‡∏≠‡∏∞

‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡πá‡∏Å ‡∏°.4 ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏Å‡πâ‡∏≤‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤‡πÉ‡∏ô‡∏£‡∏±‡πâ‡∏ß‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏™‡∏π‡πà‡πÄ‡∏î‡πá‡∏Å ‡∏°.6 ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏ö‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 31 ‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏° 2026 ‡∏ô‡∏µ‡πâ ‡∏ï‡∏•‡∏≠‡∏î 3 ‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÇ‡∏Ñ‡∏ï‡∏£‡∏à‡∏∞‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏π‡πÄ‡∏•‡∏¢

‡∏Å‡∏π‡πÑ‡∏î‡πâ‡∏•‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏´‡∏•‡∏≤‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏≤‡∏Å‡πÜ ‡∏ó‡∏±‡πâ‡∏á‡πÅ‡∏Ç‡πà‡∏á‡∏ö‡∏≤‡∏™‡∏à‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏ä‡∏°‡∏õ‡πå ‡∏ó‡∏≥‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå PTK Connext ‡∏£‡πà‡∏ß‡∏°‡∏•‡∏∏‡∏¢ D-Youth ‡πÄ‡∏õ‡∏¥‡∏î‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à ''‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà Studio'' ‡πÑ‡∏õ‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏∏‡∏¢‡∏™‡∏≤‡∏¢‡πÄ‡∏ó‡∏Ñ‡∏≠‡∏¢‡πà‡∏≤‡∏á Bangmod Hackathon, Creative AI Camp ‡πÅ‡∏•‡∏∞ JWC ‡πÅ‡∏ñ‡∏°‡∏¢‡∏±‡∏á‡πÑ‡∏î‡πâ‡∏°‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÉ‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô ODOS ‡πÑ‡∏õ‡πÑ‡∏Å‡∏•‡∏ñ‡∏∂‡∏á Seattle ‡∏≠‡∏µ‡∏Å ‡∏ó‡∏∏‡∏Å‡πÜ ‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå ‡∏ó‡∏∏‡∏Å‡πÜ ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤ ‡∏°‡∏±‡∏ô‡∏´‡∏•‡πà‡∏≠‡∏´‡∏•‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏Å‡∏π‡πÄ‡∏õ‡πá‡∏ô ''‡πÄ‡∏à‡∏™'' ‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ

‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÜ ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏≠‡∏¢‡∏ã‡∏±‡∏û‡∏û‡∏≠‡∏£‡πå‡∏ï ‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≠‡∏¢‡∏¢‡∏¥‡πâ‡∏° ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏´‡∏±‡∏ß‡πÄ‡∏£‡∏≤‡∏∞ ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏°‡πâ‡πÅ‡∏ï‡πà‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏ô‡∏±‡πà‡∏á‡∏õ‡∏±‡πà‡∏ô‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ô ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏≠ ''‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥'' ‡∏ó‡∏µ‡πà‡∏Å‡∏π‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏•‡∏∑‡∏°

‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà The Last Goodbye... ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÅ‡∏¢‡∏Å‡∏¢‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ô‡πÑ‡∏õ‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏ô‡∏∞ ü§ç', ARRAY['/ptk-memory-1.jpg', '/ptk-memory-1.jpg', '/ptk-memory-1.jpg'], TRUE, NOW()
WHERE NOT EXISTS (SELECT 1 FROM friends WHERE slug = 'home');
